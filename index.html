function checkNicknameAvailability(nickname) {
    return firestore.collection('users').get().then(snapshot => {
        let nicknameExists = false;
        snapshot.forEach(doc => {
            if (doc.data().nickname === nickname) {
                nicknameExists = true;
            }
        });
        return !nicknameExists;
    });
}

function register(userData) {
    const { nickname, password } = userData;
    return checkNicknameAvailability(nickname).then(isAvailable => {
        if (isAvailable) {
            // Proceed with account creation
            return firestore.collection('users').add({
                nickname,
                password,
            });
        } else {
            throw new Error('Nickname is already taken.');
        }
    });
}